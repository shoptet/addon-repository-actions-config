name: ðŸš€ Shoptet addon deploy workflow

on:
  workflow_call:
    secrets: 
      ftp_password:
        required: true
  push:
    branches:
      - main
      - master

jobs:
  build:
    name: ðŸš€ Build Dev ðŸš€
    runs-on: ubuntu-latest
    steps:
    - name: ðŸšš Get latest code
      uses: actions/checkout@v3

    - name: Minify styles and scripts
      run: |
          rm -rf dist
          mkdir dist
          npm i minify -g
          minify src/header/*.js > dist/scripts.header.min.js
          minify src/header/*.css > dist/styles.header.min.css
          minify src/header/*.html > dist/markups.header.html
          minify src/footer/*.js > dist/scripts.footer.min.js
          minify src/footer/*.css > dist/styles.footer.min.css
          minify src/footer/*.html > dist/markups.footer.html
          minify src/orderFinale/*.js > dist/scripts.orderFinale.min.js
          minify src/orderFinale/*.css > dist/styles.orderFinale.min.css
          minify src/orderFinale/*.html > dist/markups.orderFinale.html

    - name: Cleanup dist folder
      run: |
          cd dist
          find . -type f -empty -print -delete

    - name: Save production artifacts
      uses: actions/upload-artifact@v3
      with:
        name: dist
        path: |
            dist
        if-no-files-found: error