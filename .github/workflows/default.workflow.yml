name: ðŸš€ Shoptet addon deploy workflow

on:
  workflow_call:
  push:
    branches:
      - main
      - master

jobs:
  build:
    name: ðŸš€ Build Dev ðŸš€
    runs-on: ubuntu-latest
    steps:
    - name: ðŸšš Get latest code
      uses: actions/checkout@v3

    - name: Minify styles, scripts and markups
      run: |
          rm -rf dist
          mkdir dist
          cat src/header/*.js > dist/scripts.header.min.js
          cat src/header/*.css > dist/styles.header.min.css
          cat src/header/*.html > dist/markups.header.html
          cat src/footer/*.js > dist/scripts.footer.min.js
          cat src/footer/*.css > dist/styles.footer.min.css
          cat src/footer/*.html > dist/markups.footer.html
          cat src/orderFinale/*.js > dist/scripts.orderFinale.min.js
          cat src/orderFinale/*.css > dist/styles.orderFinale.min.css
          cat src/orderFinale/*.html > dist/markups.orderFinale.html

    - name: Cleanup dist folder
      run: |
          cd dist
          find . -type f -empty -print -delete
          
    - name: Copy assets files
      run: |
          ls -l
          if [ -d "assets" ]; then
            mkdir dist/assets
            cp -r assets dist
          fi


    - name: Save production artifacts
      uses: actions/upload-artifact@v3
      with:
        name: dist-build
        path: |
            dist
        if-no-files-found: error
